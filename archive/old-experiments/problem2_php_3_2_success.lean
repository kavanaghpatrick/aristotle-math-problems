/-
This file was generated by Aristotle.

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 66bc8e1d-5782-4137-b77b-ce7a85533f7b
-/

/-
This module defines a simple SAT solver and verifies the unsatisfiability of the Pigeonhole Principle for 3 pigeons and 2 holes (PHP-3-2).
It defines literals, clauses, and CNF formulas, along with an evaluation function.
The main theorem `php_3_2_unsat` proves that the PHP-3-2 formula is unsatisfiable by exhaustively checking all assignments using `native_decide`.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

-- Define literals and clauses
inductive Lit where
  | pos : Nat → Lit
  | neg : Nat → Lit
  deriving Repr, DecidableEq

def Clause := List Lit
def CNF := List Clause

-- The PHP-3-2 formula (3 pigeons, 2 holes)
def php_3_2 : CNF := [
  [Lit.pos 1, Lit.pos 2],              -- Pigeon 1 in some hole
  [Lit.pos 3, Lit.pos 4],              -- Pigeon 2 in some hole
  [Lit.pos 5, Lit.pos 6],              -- Pigeon 3 in some hole
  [Lit.neg 1, Lit.neg 3],              -- Not both in hole 1 (pigeons 1,2)
  [Lit.neg 1, Lit.neg 5],              -- Not both in hole 1 (pigeons 1,3)
  [Lit.neg 3, Lit.neg 5],              -- Not both in hole 1 (pigeons 2,3)
  [Lit.neg 2, Lit.neg 4],              -- Not both in hole 2 (pigeons 1,2)
  [Lit.neg 2, Lit.neg 6],              -- Not both in hole 2 (pigeons 1,3)
  [Lit.neg 4, Lit.neg 6]               -- Not both in hole 2 (pigeons 2,3)
]

-- Assignment type (variable → Bool)
def Assignment := Nat → Bool

-- Evaluate literal under assignment
def eval_lit (a : Assignment) (l : Lit) : Bool :=
  match l with
  | Lit.pos n => a n
  | Lit.neg n => !(a n)

-- Evaluate clause (OR of literals)
def eval_clause (a : Assignment) (c : Clause) : Bool :=
  c.any (eval_lit a)

-- Evaluate CNF (AND of clauses)
def eval_cnf (a : Assignment) (cnf : CNF) : Bool :=
  cnf.all (eval_clause a)

-- Check if CNF is satisfiable (exists assignment making it true)
def is_sat (cnf : CNF) : Bool :=
  -- For 6 variables, check all 2^6 = 64 assignments
  let n := 6
  (List.range (2^n)).any fun i =>
    let a := fun v => (i >>> (v-1)) % 2 == 1
    eval_cnf a cnf

-- Main theorem: PHP-3-2 is UNSAT
theorem php_3_2_unsat : is_sat php_3_2 = false := by
  native_decide