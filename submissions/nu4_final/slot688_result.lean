/-
This file was generated by Aristotle (https://aristotle.harmonic.fun).

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: bf75141f-89a3-4b30-9c9c-be3bd37baf94

To cite Aristotle, tag @Aristotle-Harmonic on GitHub PRs/issues, and add as co-author to commits:
Co-authored-by: Aristotle (Harmonic) <aristotle-harmonic@harmonic.fun>

Aristotle's budget for this request has been reached.
If there is partial progress, it will appear in this file.
If you would like to continue working off of this partial progress,
please submit the same prompt, and add this .lean file in "Optional: Attach a Lean file as context" field.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

#synth NumberField (CyclotomicField 5 ℚ)

def IsRegularPrime (p : ℕ) : Prop :=
  p.Prime ∧ ¬ (p ∣ NumberField.classNumber (CyclotomicField p ℚ))

def RegularPrimeConjecture : Prop := Set.Infinite {p : ℕ | IsRegularPrime p}

/-
The statement that there are infinitely many regular primes is equivalent to the Regular Prime Conjecture.
-/
theorem regular_primes_infinite_iff_conjecture : Set.Infinite {p : ℕ | p.Prime ∧ IsRegularPrime p} ↔ RegularPrimeConjecture := by
  unfold IsRegularPrime;
  aesop

#synth Fintype (ClassGroup (NumberField.RingOfIntegers (CyclotomicField 2 ℚ)))

/-
The cyclotomic field of order 2 is isomorphic to the rationals.
-/
theorem cyclotomic_two_iso_rat : Nonempty (CyclotomicField 2 ℚ ≃+* ℚ) := by
  -- The cyclotomic field of order 2 is isomorphic to ℚ since it is generated by the roots of unity of order 2, which are 1 and -1.
  have h_iso : CyclotomicField 2 ℚ ≃ₐ[ℚ] ℚ := by
    have h_iso : IsCyclotomicExtension {2} ℚ (CyclotomicField 2 ℚ) := by
      infer_instance;
    have h_iso : IsCyclotomicExtension {2} ℚ ℚ := by
      constructor;
      · norm_num [ IsPrimitiveRoot.iff_def ];
        exact Or.inr fun l hl => even_iff_two_dvd.mp ( by by_cases h : Even l <;> simp_all +decide );
      · exact fun x => Subalgebra.algebraMap_mem _ x;
    exact?;
  exact ⟨ h_iso.toRingEquiv ⟩

/-
The class number of the 2nd cyclotomic field is 1.
-/
theorem classNumber_cyclotomic_two_eq_one : NumberField.classNumber (CyclotomicField 2 ℚ) = 1 := by
  have h_iso : Nonempty (CyclotomicField 2 ℚ ≃+* ℚ) := cyclotomic_two_iso_rat
  have h_iso_ring : Nonempty (NumberField.RingOfIntegers (CyclotomicField 2 ℚ) ≃+* ℤ) := by
    obtain ⟨ f ⟩ := h_iso;
    refine' ⟨ _ ⟩;
    have h_iso : NumberField.RingOfIntegers (CyclotomicField 2 ℚ) ≃+* NumberField.RingOfIntegers ℚ := by
      have h_iso : CyclotomicField 2 ℚ ≃+* ℚ := f
      exact?;
    exact h_iso.trans ( by exact? );
  convert NumberField.classNumber_eq_one_iff.mpr _;
  obtain ⟨ e ⟩ := h_iso_ring;
  have h_iso : ∀ I : Ideal (NumberField.RingOfIntegers (CyclotomicField 2 ℚ)), ∃ J : Ideal ℤ, I = J.map e.symm.toRingHom := by
    intro I
    use Ideal.map e.toRingHom I;
    simp +decide [ Ideal.map_map ];
  refine' ⟨ fun I => _ ⟩;
  obtain ⟨ J, rfl ⟩ := h_iso I;
  obtain ⟨ x, hx ⟩ := IsPrincipalIdealRing.principal J;
  use e.symm x;
  simp +decide [ hx, Ideal.map_span ]

/-
2 is a regular prime.
-/
theorem isRegularPrime_two : IsRegularPrime 2 := by
  rw [IsRegularPrime, classNumber_cyclotomic_two_eq_one]
  norm_num

/-
3 is a regular prime.
-/
theorem isRegularPrime_three : IsRegularPrime 3 := by
  -- Apply the theorem that the class number of the 3rd cyclotomic field is 1.
  have h_class_number : NumberField.classNumber (CyclotomicField 3 ℚ) = 1 := by
    -- The ring of integers of the 3rd cyclotomic field is a PID.
    have h_pid : IsPrincipalIdealRing (NumberField.RingOfIntegers (CyclotomicField 3 ℚ)) := by
      exact?;
    exact?;
  exact ⟨ by norm_num, by norm_num [ h_class_number ] ⟩

/-
5 is a regular prime.
-/
theorem isRegularPrime_five : IsRegularPrime 5 := by
  constructor <;> norm_num;
  unfold NumberField.classNumber;
  -- By definition of class group, the class number of the cyclotomic field of order 5 is equal to the cardinality of its class group.
  have h_class_number : Fintype.card (ClassGroup (NumberField.RingOfIntegers (CyclotomicField 5 ℚ))) = 1 := by
    convert NumberField.classNumber_eq_one_iff.mpr _;
    exact?;
  aesop

/-
Kummer's Criterion condition.
-/
def KummerCriterion (p : ℕ) : Prop :=
  ∀ k, 2 ≤ k → k ≤ p - 3 → Even k → ¬ ((p : ℤ) ∣ (bernoulli' k).num)