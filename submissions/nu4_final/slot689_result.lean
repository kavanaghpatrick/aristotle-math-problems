/-
This file was generated by Aristotle (https://aristotle.harmonic.fun).

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: a736cf63-b5eb-40ae-ab9b-44f47f1cb841

To cite Aristotle, tag @Aristotle-Harmonic on GitHub PRs/issues, and add as co-author to commits:
Co-authored-by: Aristotle (Harmonic) <aristotle-harmonic@harmonic.fun>
-/

/-
We formalized the statement of the Jacobian Conjecture for polynomial maps over a field of characteristic zero. We defined regular functions, their composition, and the Jacobian matrix. We also defined the concept of a cubic homogeneous map and stated the Drużkowski Conjecture, which asserts that the Jacobian Conjecture for cubic homogeneous maps implies the full Jacobian Conjecture. The full Jacobian Conjecture remains an open problem.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

abbrev RegularFunction (k : Type*) (Dom Cod : Type*) [CommSemiring k] := Cod → MvPolynomial Dom k

def RegularFunction.comp {k : Type*} [CommRing k] {σ τ ρ : Type*} (G : RegularFunction k σ τ) (F : RegularFunction k ρ σ) : RegularFunction k ρ τ :=
  fun i => MvPolynomial.aeval F (G i)

def RegularFunction.Jacobian {k : Type*} [CommRing k] {σ : Type*} [Fintype σ] [DecidableEq σ] (F : RegularFunction k σ σ) : Matrix σ σ (MvPolynomial σ k) :=
  fun i j => MvPolynomial.pderiv j (F i)

/-
The Jacobian determinant of a regular function F is the determinant of its Jacobian matrix.
-/
def jacobianDet {k : Type*} [CommRing k] {n : ℕ} (F : RegularFunction k (Fin n) (Fin n)) : MvPolynomial (Fin n) k :=
  (F.Jacobian).det

def RegularFunction.id (k : Type*) (σ : Type*) [CommRing k] : RegularFunction k σ σ :=
  fun i => MvPolynomial.X i

#check MvPolynomial.IsHomogeneous

/-
A regular function F is of cubic homogeneous form if F = X + H where each component of H is a homogeneous polynomial of degree 3.
-/
def is_cubic_homogeneous_form {k : Type*} [CommRing k] {n : ℕ} (F : RegularFunction k (Fin n) (Fin n)) : Prop :=
  ∃ H : RegularFunction k (Fin n) (Fin n), F = (fun i => MvPolynomial.X i + H i) ∧ ∀ i, (H i).IsHomogeneous 3

/-
The statement of the Jacobian Conjecture: If F : k^n -> k^n is a polynomial map over a field of characteristic zero with det(JF) a nonzero constant, then F has a polynomial inverse.
-/
def JacobianConjecture : Prop :=
  ∀ (k : Type*) [Field k] [CharZero k] {n : ℕ} (F : RegularFunction k (Fin n) (Fin n)),
    IsUnit (jacobianDet F) → ∃ G, G.comp F = RegularFunction.id k (Fin n) ∧ F.comp G = RegularFunction.id k (Fin n)

/-
The Jacobian Conjecture restricted to cubic homogeneous maps.
-/
def CubicHomogeneousJacobianConjecture : Prop :=
  ∀ (k : Type*) [Field k] [CharZero k] {n : ℕ} (F : RegularFunction k (Fin n) (Fin n)),
    is_cubic_homogeneous_form F → IsUnit (jacobianDet F) →
    ∃ G, G.comp F = RegularFunction.id k (Fin n) ∧ F.comp G = RegularFunction.id k (Fin n)

#check JacobianConjecture
#check CubicHomogeneousJacobianConjecture

/-
The statement of the Drużkowski Conjecture: The Jacobian Conjecture for cubic homogeneous maps implies the full Jacobian Conjecture.
-/
def DruzkowskiConjectureStatement.{u} : Prop :=
  CubicHomogeneousJacobianConjecture.{u} → JacobianConjecture.{u}