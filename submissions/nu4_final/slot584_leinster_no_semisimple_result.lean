/-
This file was generated by Aristotle (https://aristotle.harmonic.fun).

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 319065f3-c3fb-4fe6-bf42-3ddf2dd11e30

To cite Aristotle, tag @Aristotle-Harmonic on GitHub PRs/issues, and add as co-author to commits:
Co-authored-by: Aristotle (Harmonic) <aristotle-harmonic@harmonic.fun>
-/

/-
This module defines Leinster groups and proves that no finite simple group (of order > 1) is a Leinster group. A Leinster group is a finite group where the sum of the orders of its normal subgroups equals twice the order of the group.
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

/-
Definition of a Leinster group: the sum of the orders of its normal subgroups equals twice the order of the group.
-/
def IsLeinster (G : Type*) [Group G] [Fintype G] : Prop :=
  ∑ H : {H : Subgroup G // H.Normal}, Fintype.card H = 2 * Fintype.card G

/-
A non-abelian simple group (or any simple group with order > 1) is not a Leinster group.
-/
theorem simple_not_leinster (G : Type*) [Group G] [Fintype G]
    [IsSimpleGroup G] (hG : 1 < Fintype.card G) :
    ¬ IsLeinster G := by
      -- Since $G$ is simple and non-abelian, its only normal subgroups are the trivial subgroup $\{e\}$ and the entire group $G$ itself.
      have h_normal_subgroups : ∀ H : Subgroup G, H.Normal → H = ⊥ ∨ H = ⊤ := by
        exact?;
      have h_sum_normal_subgroups : ∑ H : {H : Subgroup G // H.Normal}, Fintype.card H = Fintype.card (⊥ : Subgroup G) + Fintype.card (⊤ : Subgroup G) := by
        have h_sum_normal_subgroups : Finset.image (fun H : {H : Subgroup G // H.Normal} => H.val) (Finset.univ : Finset {H : Subgroup G // H.Normal}) = {⊥, ⊤} := by
          ext H
          simp [h_normal_subgroups];
          exact ⟨ h_normal_subgroups H, by rintro ( rfl | rfl ) <;> infer_instance ⟩;
        have h_sum_normal_subgroups : ∑ H : {H : Subgroup G // H.Normal}, Fintype.card H = ∑ H ∈ ({⊥, ⊤} : Finset (Subgroup G)), Fintype.card H := by
          rw [ ← h_sum_normal_subgroups, Finset.sum_image ] ; aesop;
        rw [ h_sum_normal_subgroups, Finset.sum_pair ] ; aesop;
        simp +decide [ Subgroup.eq_top_iff' ];
      simp_all +decide [ IsLeinster ];
      linarith