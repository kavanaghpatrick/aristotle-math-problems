/-
This file was generated by Aristotle (https://aristotle.harmonic.fun).

Lean version: leanprover/lean4:v4.24.0
Mathlib version: f897ebcf72cd16f89ab4577d0c826cd14afaafc7
This project request had uuid: 09573ca3-2012-40e5-9468-dc2a6ec7885e

To cite Aristotle, tag @Aristotle-Harmonic on GitHub PRs/issues, and add as co-author to commits:
Co-authored-by: Aristotle (Harmonic) <aristotle-harmonic@harmonic.fun>
-/

/-
We formalized the Erdős Problem 825 regarding the existence of a constant C such that σ(n) > C*n implies n is a sum of distinct proper divisors (pseudoperfect).

Key definitions and results:
- `Erdos825Property C`: The property that σ(n) > C*n implies n is pseudoperfect.
- `Erdos825Conjecture`: The statement that there exists some C satisfying the property.
- `erdos_825_lower_bound`: Proof that any such C must be strictly greater than 2, using the existence of weird numbers (specifically 70).
- `not_erdos_825_two`: Explicit statement that C=2 is insufficient.
- `power_of_two_not_pseudoperfect`: Proof that powers of 2 are not pseudoperfect.
- `perfect_implies_pseudoperfect`: Proof that perfect numbers are pseudoperfect.
- `pseudoperfect_mul`: Proof that any non-zero multiple of a pseudoperfect number is pseudoperfect.
- `erdos_825_monotonicity`: Proof that the property is monotonic in C.
- `answer`: Defined as the existence of C > 2 satisfying the property.
- `erdos_825`: Proof that `answer` is equivalent to the existence of any C > 0 satisfying the property.

We attempted to prove that multiply-perfect numbers (k ≥ 3) are pseudoperfect but the ATP timed out; however, we successfully proved the base case (perfect numbers) and the inductive step (multiples of pseudoperfect numbers).
-/

import Mathlib

set_option linter.mathlibStandardSet false

open scoped BigOperators
open scoped Real
open scoped Nat
open scoped Classical
open scoped Pointwise

set_option maxHeartbeats 0
set_option maxRecDepth 4000
set_option synthInstance.maxHeartbeats 20000
set_option synthInstance.maxSize 128

set_option relaxedAutoImplicit false
set_option autoImplicit false

noncomputable section

/-
A constant C satisfies the Erdos 825 property if every natural number n with σ(n) > C*n is pseudoperfect.
-/
def Erdos825Property (C : ℝ) : Prop :=
  ∀ n : ℕ, ((ArithmeticFunction.sigma 1) n : ℝ) > C * (n : ℝ) → Nat.Pseudoperfect n

/-
Any constant C satisfying the Erdos 825 property must be strictly greater than 2.
-/
theorem erdos_825_lower_bound : ∀ C, Erdos825Property C → C > 2 := by
  intro C hC
  have h70 : (ArithmeticFunction.sigma 1) 70 > C * 70 → Nat.Pseudoperfect 70 := by
    exact hC 70;
  contrapose! h70;
  refine ⟨ ?_, ?_ ⟩;
  · exact lt_of_le_of_lt ( mul_le_mul_of_nonneg_right h70 ( by norm_num ) ) ( by norm_cast );
  · unfold Nat.Pseudoperfect; norm_num; native_decide;

/-
Powers of 2 are not pseudoperfect (cannot be written as a sum of distinct proper divisors).
-/
theorem power_of_two_not_pseudoperfect (k : ℕ) : ¬ Nat.Pseudoperfect (2 ^ k) := by
  simp +decide [ Nat.Pseudoperfect ];
  -- The sum of all proper divisors of $2^k$ is $2^k - 1$, which is less than $2^k$.
  have h_sum_proper_divisors : ∑ i ∈ Nat.properDivisors (2 ^ k), i = 2 ^ k - 1 := by
    norm_num [ Nat.geomSum_eq ];
  exact fun x hx₁ hx₂ => by linarith [ Nat.sub_add_cancel ( Nat.one_le_pow k 2 zero_lt_two ), show ∑ i ∈ x, i ≤ ∑ i ∈ Nat.properDivisors ( 2 ^ k ), i from Finset.sum_le_sum_of_subset hx₁ ] ;

/-
Every perfect number is pseudoperfect.
-/
theorem perfect_implies_pseudoperfect (n : ℕ) (h : Nat.Perfect n) : Nat.Pseudoperfect n := by
  exact?

/-
The Erdős 825 Conjecture states that there exists a constant C such that every number n with σ(n) > C*n is pseudoperfect.
-/
def Erdos825Conjecture : Prop := ∃ C, Erdos825Property C

/-
The constant C=2 does not satisfy the Erdos 825 property.
-/
theorem not_erdos_825_two : ¬ Erdos825Property 2 := by
  -- Apply the theorem that states if Erdos825Property C holds, then C > 2.
  have := erdos_825_lower_bound 2; aesop

/-
The Erdos 825 property is monotonic: if it holds for C1, it holds for any C2 ≥ C1.
-/
theorem erdos_825_monotonicity {C1 C2 : ℝ} (h : C1 ≤ C2) (h1 : Erdos825Property C1) : Erdos825Property C2 := by
  intro n hn; exact h1 n ( by nlinarith [ show ( n : ℝ ) > 0 from by exact Nat.cast_pos.mpr ( Nat.pos_of_ne_zero ( by rintro rfl; norm_num at hn ) ) ] ) ;

/-
Every non-zero multiple of a pseudoperfect number is pseudoperfect.
-/
theorem pseudoperfect_mul (n m : ℕ) (hm : m ≠ 0) (h : Nat.Pseudoperfect n) : Nat.Pseudoperfect (m * n) := by
  rcases eq_or_ne n 0 with rfl | hn <;> simp_all +decide [ Nat.Pseudoperfect ];
  obtain ⟨ s, hs₁, hs₂ ⟩ := h.2;
  refine' ⟨ Nat.pos_of_ne_zero hm, Finset.image ( fun x => m * x ) s, _, _ ⟩ <;> simp_all +decide [ Finset.subset_iff ];
  · exact fun x hx => ⟨ mul_dvd_mul_left _ ( hs₁ hx |>.1 ), mul_lt_mul_of_pos_left ( hs₁ hx |>.2 ) ( Nat.pos_of_ne_zero hm ) ⟩;
  · rw [ ← hs₂, Finset.mul_sum _ _ _ ]

/-
The existence of a constant C > 0 for the Erdos 825 property is equivalent to the existence of a constant C > 2.
-/
def answer : Prop := ∃ C > 2, Erdos825Property C

theorem erdos_825 : answer ↔ ∃ C > 0, Erdos825Property C := by
  constructor;
  · exact fun h => ⟨ h.choose, lt_of_le_of_lt ( by norm_num ) h.choose_spec.1, h.choose_spec.2 ⟩;
  · exact fun ⟨ C, h₀, h₁ ⟩ => ⟨ C, by linarith [ erdos_825_lower_bound C h₁ ], h₁ ⟩